{% extends "base.html" %}
{% load widget_tweaks %}
{% load static %}


{% block content %}
<div class="max-w-7xl mx-auto p-6">
  <h1 class="text-2xl font-bold mb-6">üìä Admin Dashboard</h1>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="bg-white rounded-lg shadow p-6">
      <p class="text-sm text-gray-500">Monthly Gross Income</p>
      <p class="text-3xl font-bold mt-2">‡ß≥ {{ monthly_income|floatformat:2 }}</p>
      <canvas id="monthlyChart" width="400" height="200"></canvas>
    </div>
    <div class="bg-white rounded-lg shadow p-6">
      <p class="text-sm text-gray-500">Yearly Gross Income</p>
      <p class="text-3xl font-bold mt-2">‡ß≥ {{ yearly_income|floatformat:2 }}</p>
      <canvas id="yearlyChart" width="400" height="200"></canvas>
    </div>
  </div>
  <div class="bg-white rounded-lg shadow p-6 mt-6">
    <h2 class="text-lg font-semibold mb-4">‚ö° Quick Create Product</h2>
    <form method="post" enctype="multipart/form-data" class="space-y-4">
      {% csrf_token %}
      <input type="hidden" name="quick_create" value="1" />
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium">Name</label>
          {{ quick_form.name|add_class:"w-full border rounded p-2"}}
        </div>
        <div>
          <label class="block text-sm font-medium">Price</label>
          {{ quick_form.price|add_class:"w-full border rounded p-2"}}
        </div>
        <div>
          <label class="block text-sm font-medium">Stock</label>
          {{ quick_form.stock|add_class:"w-full border rounded p-2"}}
        </div>
        {% if quick_form.image %}
        <div>
          <label class="block text-sm font-medium">Image</label>
          {{ quick_form.image|add_class:"w-full border rounded p-2"}}
        </div>
        {% endif %}
      </div>
      <button class="bg-indigo-6 text-white px-4 py-2 rounded hover:bg-indigo-700">Create</button>
    </form>
  </div>

  <div class="bg-white rounded-lg shadow p-6 mt-6">
    <h2 class="text-lg font-semibold mb-4">üì¶ Products</h2>
    <a href="{% url 'product_create' %}" class="text-sm bg-green-600 text-white px-3 py-2 rounded hover:bg-green-700">
      + Add Product
    </a>
    <table class="min-w-full text-sm border">
      <thead>
        <tr class="bg-gray-100 text-left">
          <th class="px-3 py-2">Name</th>
          <th class="px-3 py-2">Price</th>
          <th class="px-3 py-2">Stock</th>
          <th class="px-3 py-2">Seller</th>
          <th class="px-3 py-2">Actions</th>
          <th class="px-3 py-2">Add Qty</th>
        </tr>
      <thead>
      <tbody>
        {% for p in products %}
          <tr class="border-t hover:bg-gray-50">
            <td class="px-3 py-2 font-medium">{{ p.name }}</td>
            <td class="px-3 py-2">‡ß≥ {{ p.price }}</td>
            <td class="px-3 py-2">
              <span class="px-2 py-1 rounded text-white 
                {% if p.stock <= 0 %}bg-red-600
                {% elif p.stock < 5 %}bg-yellow-600
                {% else %}bg-emerald-600{% endif %}">
                {{ p.stock }}
              </span>
            </td>
            <td class="px-3 py-2">
              {% if p.seller %}
                {{ p.seller.username }}
              {% else %}
                <span class="text-gray-400">No Seller</span>
              {% endif %}
            </td>
            <td class="px-3 py-2 space-x-2">
              <a href="{% url 'product_update' p.id %}" class="text-blue-600 hover:underline">Edit</a>
              <a href="{% url 'product_delete' p.id %}" class="text-red-600 hover:underline">Delete</a>
            </td>
            <td class="px-3 py-2">
              <form action="{% url 'update_product_quantity' p.id %}" method="post" class="flex items-center space-x-2">
                {% csrf_token %}
                {{ stock_form.delta|add_class:"w-20 border rounded p-1" }}
                <button class="bg-gray-800 text-white px-3 py-1 rounded hover:bg-black">Add</button>
              </form>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="px-3 py-4 text-gray-500 text-center">No Prodcuts Found</td>
          </tr>
          {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-lg font-semibold mb-3">üë®‚Äçüíº Sellers</h2>
      <ul class="space-y-2">
        {% for s in sellers %}
        <li class="flex justify-between border-b py-2">
          <span class="font-medium">{{ s.username }}</span>
          <a href="{% url 'user_profile' s.id %}" class="text-indigo-600 hover:underline">View</a>
        </li>
        {% empty %}
        <li class="text-gray-500">No Sellers Found</li>
        {% endfor %}
      </ul>
    </div>

    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-lg font-semibold mb-3">üë• Customers</h2>
      <ul class="space-y-2">
        {% for c in customers %}
        <li class="flex justify-between border-b py-2">
          <span class="font-medium">{{ c.username }}</span>
          <a href="{% url 'user_profile' c.id %}" class="text-indigo-600 hover:underline">View</a>
        </li>
        {% empty %}
        <li class="text-gray-500">No Customers Found</li>
        {% endfor %}
      </ul>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
new Chart(monthlyCtx, {
  type: 'bar',
  data: {
    labels: [{% for lbl in monthly_labels %}"{{ lbl }}"{% if not forloop.last %},{% endif %}{% endfor %}],
    datasets: [{
      label: 'Monthly Revenue',
      data: [{% for v in monthly_values %}{{ v }}{% if not forloop.last %},{% endif %}{% endfor %}],
      backgroundColor: 'rgba(99, 102, 241, 0.7)',
      borderColor: 'rgba(99, 102, 241, 1)',
      borderWidth: 1
    }]
  },
  options: { scales: { y: { beginAtZero: true } } }
});


const yearlyCtx = document.getElementById('yearlyChart').getContext('2d');
new Chart(yearlyCtx, {
  type: 'line',
  data: {
    labels: [{% for lbl in yearly_labels %}"{{ lbl }}"{% if not forloop.last %},{% endif %}{% endfor %}]
    datasets: [{
      label: 'Yearly Revenue',
      data: [{% for v in yearly_values %}{{ v }}{% if not forloop.last %},{% endif %}{% endfor %}],
      backgroundColor: 'rgba(16, 185, 129, 0.3)',
      borderColor: 'rgba(5, 150, 105, 1)',
      borderWidth: 2,
      fill: true,
      tension: 0.4
    }]
  },
  options: { scales: { y: { beginAtZero: true } } }
});
</script>

{% endblock content %}}

  


